{% extends 'base.html' %}

{% block content %}
    <div class="pagetitle mb-4">
        <h1>äº¤äº’åˆ†æ</h1>
        <nav>
            <ol class="breadcrumb mt-2">
                <li class="breadcrumb-item"><a href="/index">é¦–é¡µ</a></li>
                <li class="breadcrumb-item">{{ contact.name }}</li>
                <li class="breadcrumb-item active">äº¤äº’åˆ†æ</li>
            </ol>
        </nav>
    </div>

    <section class="section dashboard">
        <div class="row">
            <!-- å“åº”æ—¶é—´åˆ†æ -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">â±ï¸å“åº”æ—¶é—´</h5>
                        <div id="responseTimeChart" style="min-height: 400px;" class="echart"></div>
                    </div>
                </div>
            </div>

            <!-- äº’åŠ¨æƒ…å†µåˆ†æ -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">ğŸ’¬ äº’åŠ¨æƒ…å†µ</h5>
                        <div id="interactionChart" style="min-height: 400px;" class="echart"></div>
                    </div>
                </div>
            </div>

            <!-- å¯¹è¯é—´éš”åˆ†æ -->
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">â³ å¯¹è¯é—´éš”</h5>
                        <div id="chatPatternChart" style="min-height: 300px;" class="echart"></div>
                    </div>
                </div>
            </div>

            <!-- èŠå¤©çƒ­åŠ›å›¾ -->
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">ğŸŒ¡ï¸ èŠå¤©çƒ­åŠ›å›¾</h5>
                        <div id="chatHeatmap" style="min-height: 400px;" class="echart"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // æ ‡è®°å½“å‰é¡µé¢çš„å¯¼èˆªé¡¹ä¸ºæ¿€æ´»çŠ¶æ€
            const currentNav = document.querySelector(`a[href="/contact/{{ contact.id }}/interactive"]`);
            if (currentNav) {
                currentNav.classList.add('active');
                // å±•å¼€å¹¶é«˜äº®çˆ¶çº§èœå•
                const parentCollapse = currentNav.closest('.collapse');
                if (parentCollapse) {
                    parentCollapse.classList.add('show');
                    const parentNavLink = document.querySelector(`[data-bs-target="#${parentCollapse.id}"]`);
                    if (parentNavLink) {
                        parentNavLink.classList.remove('collapsed');
                        parentNavLink.classList.add('active-parent');
                    }
                }
            }

            // åŠ è½½å›¾è¡¨æ•°æ®
            fetch(`/api/contacts/{{ contact.id }}/interactive/stats`)
                .then(response => response.json())
                .then(data => {
                    console.log('Received data:', data);
                    if (data.chat_pattern && data.response_time && data.heatmap && data.interaction) {
                        initChatPatternChart(data);
                        initResponseTimeChart(data);
                        initChatHeatmap(data);
                        initInteractionChart(data);
                    } else {
                        console.error('Missing data:', data);
                    }
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                });
        });
    </script>
{% endblock %} 